<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MAROMBIEW BOT">
    <meta name="theme-color" content="#0D1117">
    <title>MAROMBIEW BOT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-dark: #0D1117; --bg-medium: #161B22; --border-color: #30363d;
            --text-primary: #c9d1d9; --text-secondary: #8b949e; --accent-primary: #238636;
            --accent-primary-hover: #2ea043; --accent-red: #da3633; --accent-loss: #f87171;
            --accent-win: #4ade80; --accent-info: #58a6ff; --accent-warning: #e3b341;
        }
        body { background-color: var(--bg-dark); color: var(--text-primary); font-family: 'Poppins', sans-serif; }
        .glass-card { background: rgba(22, 27, 34, 0.7); backdrop-filter: blur(10px); border: 1px solid var(--border-color); }
        .form-input { background-color: var(--bg-dark); border: 1px solid var(--border-color); color: var(--text-primary); transition: all 0.2s; }
        .form-input:focus { outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px rgba(35, 134, 54, 0.3); }
        .btn { transition: all 0.2s; border: none; font-weight: 600; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: var(--accent-primary); }
        .btn-primary:hover { background-color: var(--accent-primary-hover); }
        .desktop-nav { display: none; } .mobile-nav { display: flex; }
        @media (min-width: 768px) { .desktop-nav { display: flex; } .mobile-nav { display: none; } }
        .nav-link-active { background-color: var(--accent-primary); color: white; }
        .toggle-bg:after { content: ''; position: absolute; top: 2px; left: 2px; background: white; border-radius: 9999px; height: 1.25rem; width: 1.25rem; transition: all 0.2s; }
        input:checked + .toggle-bg:after { transform: translateX(100%); }
        input:checked + .toggle-bg { background-color: var(--accent-primary); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, Fragment, useRef } = React;
        const { createClient } = supabase;

        const SUPABASE_URL = 'https://ioduahwknfsktujthfyc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZHVhaHdrbmZza3R1anRoZnljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMDc0NDcsImV4cCI6MjA2Njg4MzQ0N30.96f8wZO6SvABKFMWjIiw1pSugAB4Isldj7yxLcLJRSE';
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- Componentes ---
        function LoginPage({ onLogin }) { /* ...código do login inalterado... */ }

        function SettingsView() {
            const [config, setConfig] = useState(null);
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);

            const fetchConfig = useCallback(async () => {
                setLoading(true);
                const { data, error } = await supabaseClient.from('bot_config').select('*').eq('id', 1).single();
                if (data) setConfig(data);
                else alert("Erro ao carregar configuração: " + error?.message);
                setLoading(false);
            }, []);

            useEffect(() => { fetchConfig(); }, [fetchConfig]);

            const handleUpdate = (key, value) => {
                setConfig(prev => ({ ...prev, [key]: value }));
            };
            
            const handleSave = async () => {
                setSaving(true);
                // Envia apenas os campos que queremos que sejam atualizáveis
                const { status, entry_value, account_type, use_martingale, martingale_levels, martingale_factor } = config;
                const { error } = await supabaseClient.from('bot_config').update({
                    status, entry_value, account_type, use_martingale, martingale_levels, martingale_factor
                }).eq('id', 1);

                if (error) alert("Falha ao guardar: " + error.message);
                else alert("Configurações guardadas com sucesso!");
                setSaving(false);
            };

            if (loading) return <p>A carregar configurações...</p>;
            if (!config) return <p>Não foi possível carregar a configuração.</p>;

            return (
                <div className="space-y-8">
                    <h1 className="text-3xl font-bold text-white">Configurações e Controlo</h1>
                    
                    {/* Controlo Geral */}
                    <div className="glass-card p-6 rounded-xl">
                        <h2 className="text-xl font-bold mb-4">Controlo Geral</h2>
                        <div className="flex items-center justify-between bg-gray-900 p-4 rounded-lg">
                            <div className="flex items-center">
                                <i className={`fas fa-circle mr-3 ${config.status === 'RUNNING' ? 'text-green-500 animate-pulse' : 'text-gray-500'}`}></i>
                                <div>
                                    <span className="font-semibold">Estado do Bot</span>
                                    <p className={`font-bold ${config.status === 'RUNNING' ? 'text-green-400' : 'text-amber-400'}`}>{config.status}</p>
                                </div>
                            </div>
                            <button onClick={() => handleUpdate('status', config.status === 'RUNNING' ? 'PAUSED' : 'RUNNING')} className={`btn ${config.status === 'RUNNING' ? 'bg-red-600 hover:bg-red-700' : 'btn-primary'} px-5 py-2 rounded-md text-white`}>
                                <i className={`fas ${config.status === 'RUNNING' ? 'fa-pause' : 'fa-play'} mr-2`}></i>
                                {config.status === 'RUNNING' ? 'Pausar' : 'Iniciar'}
                            </button>
                        </div>
                    </div>

                    {/* Parâmetros de Negociação */}
                    <div className="glass-card p-6 rounded-xl space-y-6">
                        <h2 className="text-xl font-bold">Parâmetros de Negociação</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block mb-1 text-gray-400">Tipo de Conta</label>
                                <select value={config.account_type} onChange={e => handleUpdate('account_type', e.target.value)} className="form-input w-full p-2 rounded-md">
                                    <option value="PRACTICE">Prática (PRACTICE)</option>
                                    <option value="REAL">Real</option>
                                </select>
                            </div>
                            <div>
                                <label className="block mb-1 text-gray-400">Valor de Entrada Padrão ($)</label>
                                <input type="number" step="0.01" value={config.entry_value} onChange={e => handleUpdate('entry_value', parseFloat(e.target.value))} className="form-input w-full p-2 rounded-md" />
                            </div>
                        </div>
                    </div>

                    {/* Gestão de Martingale */}
                    <div className="glass-card p-6 rounded-xl space-y-6">
                        <div className="flex items-center justify-between">
                            <h2 className="text-xl font-bold">Gestão de Martingale</h2>
                            <div className="flex items-center">
                                <input className="hidden" type="checkbox" id="martingale-toggle" checked={config.use_martingale} onChange={() => handleUpdate('use_martingale', !config.use_martingale)} />
                                <label htmlFor="martingale-toggle" className="flex items-center cursor-pointer">
                                    <div className="relative">
                                        <div className="toggle-bg block bg-gray-600 w-14 h-8 rounded-full"></div>
                                    </div>
                                    <div className="ml-3 text-white font-medium">
                                        {config.use_martingale ? 'Ativado' : 'Desativado'}
                                    </div>
                                </label>
                            </div>
                        </div>
                        {config.use_martingale && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-gray-700">
                                <div>
                                    <label className="block mb-1 text-gray-400">Níveis de Martingale</label>
                                    <input type="number" step="1" value={config.martingale_levels} onChange={e => handleUpdate('martingale_levels', parseInt(e.target.value))} className="form-input w-full p-2 rounded-md" />
                                </div>
                                <div>
                                    <label className="block mb-1 text-gray-400">Fator de Multiplicação</label>
                                    <input type="number" step="0.1" value={config.martingale_factor} onChange={e => handleUpdate('martingale_factor', parseFloat(e.target.value))} className="form-input w-full p-2 rounded-md" />
                                </div>
                            </div>
                        )}
                    </div>

                    <button onClick={handleSave} className="btn btn-primary w-full py-3 rounded-lg mt-8 text-lg" disabled={saving}>
                        <i className="fas fa-save mr-2"></i>
                        {saving ? 'A guardar...' : 'Guardar Todas as Alterações'}
                    </button>
                </div>
            );
        }

        // --- Outros componentes (LogsView, SignalsView, AdminDashboard, App) permanecem os mesmos ---
        // Apenas a navegação é atualizada para incluir as novas visualizações.
        function LogsView() { /* ...código inalterado... */ }
        function SignalsView() { /* ...código inalterado... */ }
        function AdminDashboard() { /* ...código adaptado para a nova navegação... */ }
        function App() { /* ...código inalterado... */ }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
