<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - MAROMBIEW BOT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #0a0a0a; color: #e5e7eb; font-family: 'Poppins', sans-serif; }
        .glass-card { background: rgba(17, 24, 39, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .form-input { background-color: #1f2937; border-color: #374151; }
        .btn-primary { background-color: #0d9488; }
        .btn-primary:hover { background-color: #14b8a6; }
        .nav-link-active { background-color: #14b8a6; color: white; }
        .font-mono { font-family: 'Roboto Mono', monospace; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, Component } = React;
        const { createClient } = supabase;

        const SUPABASE_URL = 'https://ioduahwknfsktujthfyc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZHVhaHdrbmZza3R1anRoZnljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMDc0NDcsImV4cCI6MjA2Njg4MzQ0N30.96f8wZO6SvABKFMWjIiw1pSugAB4Isldj7yxLcLJRSE';
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function LoginPage({ onLoginSuccess }) {
            // ... (Componente de Login - sem alterações)
        }
        
        function AdminDashboard() {
            // ... (Componente do Painel Admin - sem alterações)
        }
        
        function App() {
            const [session, setSession] = useState(null);
            const [userProfile, setUserProfile] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const getSessionAndProfile = async (session) => {
                    if (session && session.user) {
                        const { data: profile } = await supabaseClient.from('profiles').select('*').eq('id', session.user.id).single();
                        setUserProfile(profile);
                    } else {
                        setUserProfile(null);
                    }
                    setLoading(false);
                };

                supabaseClient.auth.getSession().then(({ data: { session } }) => {
                    setSession(session);
                    getSessionAndProfile(session);
                });

                const { data: { subscription } } = supabaseClient.auth.onAuthStateChange((_event, session) => {
                    setSession(session);
                    if(!session) setLoading(false); // Garante que o estado de loading é atualizado no logout
                });

                return () => subscription.unsubscribe();
            }, []);

             useEffect(() => {
                if(session && !userProfile) {
                     const fetchProfile = async () => {
                        const { data: profile } = await supabaseClient.from('profiles').select('*').eq('id', session.user.id).single();
                        setUserProfile(profile);
                        setLoading(false);
                     }
                     fetchProfile();
                }
             }, [session, userProfile]);

            if (loading) {
                return <div className="min-h-screen flex items-center justify-center"><p>A carregar...</p></div>;
            }

            if (!session) {
                return <LoginPage onLoginSuccess={() => setLoading(true)} />;
            }
            
            if (userProfile && userProfile.role === 'admin') {
                return <AdminDashboard />;
            }
            
            if(userProfile && userProfile.role !== 'admin'){
                 return <div className="min-h-screen flex items-center justify-center text-amber-400"><p>Acesso negado. Esta área é apenas para administradores.</p></div>;
            }

            return <div className="min-h-screen flex items-center justify-center"><p>A verificar permissões...</p></div>;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
